---
title: Mapping Revitalization in Buffalo, NY, through Income, Vancancy and Demographic Made up Data from 2013 to 2015 
subtile: GEO503 Final Project First Draft
author: "Shengyuan Zou"
date: "November 4, 2017"
output:
  html_document: default
  pdf_document: default
---

##Introduction

In 2010, Buffalo Mayor Byron Brown annoucned revitalization plan for City of Buffalo. The population growth, housing vacancy rate decrease and economic revitaliztion were planned to have a positive change in recent years.To understand the revitalization and its spatial and temporal characteristics, mapping the change of variables, like median income, vacancy rate, and race ratio could provide a quantative method. The objective of this project is to map the changes of these demographical variables in Buffalo, Erie County from block-group-level census data since 2013 to 2015.

```{r setup, include=FALSE}
library(rgdal)
library(rgeos)

library(sf)
library(ggplot2)
library(dplyr)
library(tidyr)
library(maptools)
library(tigris)
library(censusapi)
```

##Data
The geometry data are block-group-level shapfile for Erie County in 2015, which is downloaded from TIGER 029 at block_group level for Erie County using tigris package.
```{r shapefile input}
shpfile<-block_groups('NY',county='Erie',year='2015')
plot(shpfile,col=1:100)

```
The demographic data,vacancy status, median household income and race data in 2013, 2014 and 2015 are downloaded from census website. The CensusAPI has been tried, but no available block-group-level data. Thus, we have to download these data manually. 
```{r data input}
Income2013=read.csv(file = 'Data/Income2013.csv')

Income2014=read.csv(file = 'Data/Income2014.csv')

Income2015=read.csv(file = 'Data/Income2015.csv')

VR2013=read.csv(file = 'Data/VacancyRate2013.csv')

VR2014=read.csv(file = 'Data/VacancyRate2014.csv')

VR2015=read.csv(file = 'Data/VacancyRate2015.csv')

Race2013=read.csv(file = 'Data/RaceRatio2013.csv')

Race2014=read.csv(file = 'Data/RaceRatio2014.csv')

Race2015=read.csv(file = 'Data/RaceRatio2015.csv')

```

##Data processing
To derive the variables, vacancy rate and race ratio(the proportion of the Whites in this case), new columns were added and their values were calculated when join these tables and calculate the difference between individual years.
```{r data processing}
Income1=merge(Income2013,Income2014,by.x = 'GEO.id2',by.y = 'GEO.id2')

Income1$Change1=as.numeric(Income1$HD01_VD01.y)-as.numeric(Income1$HD01_VD01.x)

Income2=merge(Income2014,Income2015,by.x = 'GEO.id2',by.y = 'GEO.id2')

Income2$Change2=as.numeric(Income2$HD01_VD01.y)-as.numeric(Income2$HD01_VD01.x)

VR1=merge(VR2013,VR2014,by.x = 'GEO.id2',by.y = 'GEO.id2')

VR1$Change1=as.numeric(VR1$HD01_VD03.y)/as.numeric(VR1$HD01_VD01.y)-as.numeric(VR1$HD01_VD03.x)/as.numeric(VR1$HD01_VD01.x)

VR2=merge(VR2014,VR2015,by.x = 'GEO.id2',by.y = 'GEO.id2')

VR2$Change2=as.numeric(VR2$HD01_VD03.y)/as.numeric(VR2$HD01_VD01.y)-as.numeric(VR2$HD01_VD03.x)/as.numeric(VR2$HD01_VD01.x)


Race1=merge(Race2013,Race2014,by.x = 'GEO.id2',by.y = 'GEO.id2')

Race1$Change1=as.numeric(Race1$HD01_VD02.y)/as.numeric(Race1$HD01_VD01.y)-as.numeric(Race1$HD01_VD02.x)/as.numeric(Race1$HD01_VD01.x)

Race2=merge(Race2014,Race2015,by.x = 'GEO.id2',by.y = 'GEO.id2')

Race2$Change2=as.numeric(Race2$HD01_VD02.y)/as.numeric(Race2$HD01_VD01.y)-as.numeric(Race2$HD01_VD02.x)/as.numeric(Race2$HD01_VD01.x)

```

Then join the geometry and data based on their GEOID.
```{r Join geo with data}
Income1_Join=geo_join(shpfile,Income1,'GEOID','GEO.id2',how='inner')
Income2_Join=geo_join(shpfile,Income2,'GEOID','GEO.id2',how='inner')
VR1_Join=geo_join(shpfile,VR1,'GEOID','GEO.id2',how='inner')
VR2_Join=geo_join(shpfile,VR2,'GEOID','GEO.id2',how='inner')
Race1_Join=geo_join(shpfile,Race1,'GEOID','GEO.id2',how='inner')
Race2_Join=geo_join(shpfile,Race2,'GEOID','GEO.id2',how='inner')
```
##Visualization
For now, some simple classified changes, only positive and negative, are plotted. Red represents positive change, and blue represents negative change.

```{r visualization}
#Visualize the change in house vacancy, income and demographic made up

#plot(Income1_Join[Income1_Join$Change1<-22,],add=T,col='blue')
#plot(Income1_Join[Income1_Join$Change1>-22&&Income1_Join$Change1<5,],add=T,col='yellow')
#plot(Income1_Join[Income1_Join$Change1>5&&Income1_Join$Change1<31,],add=T,col='green')
#plot(Income1_Join[Income1_Join$Change1>31,],add=T,col='red')
plot(Income1_Join,axes=TRUE)
plot(Income1_Join[Income1_Join$Change1>0,],add=T,col='red')
plot(Income1_Join[Income1_Join$Change1<0,],add=T,col='blue')

plot(VR1_Join,axes=TRUE)
plot(VR1_Join[VR2_Join$Change1>0,],add=T,col='red')
plot(VR1_Join[VR2_Join$Change1<0,],add=T,col='blue')

plot(Race1_Join,axes=TRUE)
plot(Race1_Join[Race1_Join$Change1>0,],add=T,col='red')
plot(Race1_Join[Race1_Join$Change1<0,],add=T,col='blue')


plot(Income2_Join,axes=TRUE)
plot(Income2_Join[Income2_Join$Change2>0,],add=T,col='red')
plot(Income2_Join[Income2_Join$Change2<0,],add=T,col='blue')

plot(VR2_Join,axes=TRUE)
plot(VR2_Join[VR2_Join$Change2>0,],add=T,col='red')
plot(VR2_Join[VR2_Join$Change2<0,],add=T,col='blue')

plot(Race2_Join,axes=TRUE)
plot(Race2_Join[Race2_Join$Change2>0,],add=T,col='red')
plot(Race2_Join[Race2_Join$Change2<0,],add=T,col='blue')
```
Merge two years change and summarize
```{r merge and summarize}

Income_Total=inner_join(Income1,Income2,by="GEO.id2")
Income_Total$ChangeInTwoYears<-Income_Total$Change1+Income_Total$Change2
summary(Income_Total$ChangeInTwoYears)

VR_Total=inner_join(VR1,VR2,by="GEO.id2")
VR_Total$ChangeInTwoYears<-VR_Total$Change1+VR_Total$Change2
summary(VR_Total$ChangeInTwoYears)

Race_Total=inner_join(Race1,Race2,by="GEO.id2")
Race_Total$ChangeInTwoYears<-Race_Total$Change1+Race_Total$Change2
summary(Race_Total$ChangeInTwoYears)
```

##Further work
Spatial autocorrelation of these change (Moran's I) will be tested. Some certain area with significant change will be checked with some qualitative analysis.